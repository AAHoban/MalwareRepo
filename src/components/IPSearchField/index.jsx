import React, { useCallback, useRef, useEffect } from 'react';
import { useAppContext } from '../../AppContext/index';
import './style.css';

export const IPSearchField = () => {
    const input = useRef(null);
    const isMounted = useRef(true);
    const Context = useAppContext();
    const [appState, actions] = Context;

    const handleOnClick = () => {
        actions.getLocation(input.current.value);
      };
    
      const handleEnterPress = useCallback(
        (event) => {
          if (event.key === 'Enter') {
            actions.getLocation(input.current.value);
          } else {
            return;
          }
        },
        [input, actions],
      );
    
      useEffect(() => {
        if (isMounted) {
          actions.getLocation('');
        }
    
        return () => {
          isMounted.current = false;
        };
      }, [actions]);
    
      useEffect(() => {
        window.addEventListener('keydown', handleEnterPress);
    
        return () => {
          window.removeEventListener('keydown', handleEnterPress);
        };
      }, [handleEnterPress]);

  return (
    <div className="fieldWrapper">
        <input
        ref={input}
        type="text"
        placeholder="Search for any IP address or domain"
        />
        <button class='btn' onClick={() => handleOnClick()}>
            SUMBIT
        </button>
    </div>
  )
}